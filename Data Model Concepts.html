<html>
  <head>
    <style>
      .Portal {
        border-color: lightblue;
        border-style: solid;
      }
    </style>
  </head>
  <body>
    <h1>
      Data Model Concepts
    </h1>
    <br/>
    <ul>
        <li>Fundamentals
            <ul>
                <li>Measure
                    <ul>
                        <li>A numeric value, such as a price or quantity, on which you can process arithmetic or statistics operations, such as sum, average, top N values, and calculations. eg Quantity, Sales Revenue</li>
                    </ul>
                </li>
                <li>Attribute
                    <ul>
                        <li>A descriptive element such as &#39;country&#39; that is used the provide context for a measure. For example &#39;Sales Revenue by <i>France&#39;</i>. </li>
                    </ul>
                </li>
                <li>Data Source Aliases
                    <ul>
                        <li>In some cases, you need to use the same data source more than once in a calculation view. Although it is possible to include the same data source multiple times in the same calculation view, each instance needs a unique name to identify it.</li>
                        <li><img src="https://remnote-user-data.s3.amazonaws.com/FeaZWEWLDseODBUMnJmomMS3y28Mop6zgaF-LUWALqDQ08zRE4aiZMZRvdoYqTsKI5hK2hEaGAeXeiCtbisX1xh-LAnHsSjKMDkSchu62XK7FX5HttCsFFamxSXIQnsX.png" width="479" height="280.1513292433538"/></li>
                    </ul>
                </li>
            </ul>
        </li>
        <li>Variable
            <ul>
                <li><img src="https://remnote-user-data.s3.amazonaws.com/SYcKTUHlGOiW_I8q1T02TCpBfq9_9PFR-JgXCAZu9Lsuv3DTi3FcA3cbb2YEelM8FwPbSSyxKFaD-lV-ilD4yjmCDFQdWHdzzkYE2QHIVZ7cJsTZpzyfKNgPRa0vMrof.png" width="1140" height="833.6869565217391"/></li>
                <li>Variables apply filter after execution of all nodes till the semantics (at the top level) whereas Input parameters can apply filters at any projection level.</li>
                <li>Variables are bound to attributes/specific fields whereas an input parameter is independent of any field in the view.</li>
                <li>Prompted to user when to input when used in reporting tool such as SAC</li>
                <li>You define in the Semantics node of a Calculation View, in the Parameters tab.</li>
                <li><b>Selection Type:</b> Whether selections should be based on intervals, ranges or single values.</li>
                <li><b>Multiple Entries: </b>Whether multiple occurrences of the selection type are allowed. - Each enter is appended with AND, OR logical expression</li>
                <li><b>Mandatory:</b> You can also define whether specifying the variable at runtime is Mandatory and/or if it should have a Default Value.</li>
                <li><b>View/Table Value Help:</b> The  setting is used to define which table/view SAP HANA will fetch the data to show in the prompt. The Reference Column defines which (unique) column in this table/view will provide the possible values for the variable.</li>
                <li><a isRemReference="true" href="Data%20Model%20Concepts/Value%20Help%20Based%20on%20Hierarchies.html?isPin=false">Value Help Based on Hierarchies</a></li>
                <li>Apply Filter ⇒ Attribute ⇒ Column name where to apply Filter</li>
                <li>In the semantics of a view, you can see, and also define, which variable is assigned to which attribute.</li>
                <li><img src="https://remnote-user-data.s3.amazonaws.com/k3y0PQDZ_I2bODRfiWsrw19-vQCV9XwPCT4LkbUymfHQigJ8mdH1faEA_15ECwIoTc4BVNGtxUWcv8DpUZtCdrKd0etilu4oQ2lrwlE1V7CI3mm_aE6D5Bij4U1F6SGt.png" width="1140" height="350.9217391304348"/></li>
                <li>Cannot be applied to measures</li>
                <li>For non-mandatory variables, if nothing is specified at runtime, all the data for the corresponding attributes is returned by the view without filtering if no default value is given.</li>
                <li>DECLARE &lt;variable_name&gt; &lt;type&gt; [NOT NULL] [= &lt;value&gt;]

&lt;variable_name&gt; = &lt;value&gt; or &lt;expression&gt;

//Use a variable in an expression
:&lt;variable_name&gt; </li>
            </ul>
        </li>
        <li>Value Help Based on Hierarchies
            <ul>
                <li>When creating a variable, In the Reference Column you specify a column that is associated with one or several hierarchies, you can specify one of the hierarchies in the variable definition. With this option, the user can navigate the hierarchy, rather than a flat list, to select the values in the value help. This makes navigation much easier when there are a lot of values; imagine being able to first select your country, then your department, before the list of employees appears? You can use either parent-child or level hierarchies.</li>
                <li><img src="https://remnote-user-data.s3.amazonaws.com/oLpdFp2P8ancP8NRpdg4ypWcAvEUV8z30NSxIU3-FobNsXnrXWJfCnAP09EsFh-T5TYKj4m_AfKwSBuaUlk0fQhL9MbnqJi5J9Q3lz5H8XLncTTxhv-9Pe7vxclycR_8.png" width="425" height="310.6896551724138"/></li>
                <li>If you refer to a parent-child hierarchy, the variable reference column must be defined as the parent attribute and not the child. Why? Because the system uses the parent column to build the entire tree from the top down. If you start from the child, HANA will not know how to display the upper levels in a properly nested way. ‒ This is the SAP Official ways of doing</li>
                <li>If you refer to a level hierarchy, the variable reference column must be defined at the leaf level; that is, the bottom level. - ‒ This is the SAP Official ways of doing</li>
            </ul>
        </li>
        <li>Input Parameter
            <ul>
                <li>Can be used in different places to provide dynamic values, in particular, calculated columns, restricted columns and filter expressions</li>
                <li>Can apply filters at any Node.</li>
                <li>If the user selects GROSS, the calculated column (of type Measure) will display the GROSS_AMOUNT measure in the AMOUNT column. Any other selection will result in NET_AMOUNT being displayed.</li>
                <li>if(&#39;$$GROSS_OR_NET$$&#39;=&#39;Gross&#39;,&quot;GROSS_AMOUNT&quot;,&quot;NET_AMOUNT&quot;)

SELECT &quot;PRODUCT&quot;, sum(&quot;TAXED_AMOUNT&quot;)
      FROM &quot;_SYS_BIC&quot;.&quot;MyPackage/SalesResults&quot; 
       (&#39;PLACEHOLDER&#39; = (&#39;$$Tax Amount$$&#39;, &#39;17.5&#39;)) 
GROUP BY &quot;PRODUCT&quot;  </li>
                <li>Can also be used when you have scalar or table functions in your Calculation View. The parameters of these functions can be fed with values that you enter at runtime using the <a isRemReference="true" href="Data%20Model%20Concepts/Parameter%20Mapping.html?isPin=false">Parameter Mapping</a>, when querying your calculation view</li>
                <li>Value taken from a user and is sent to placeholder $$$$   $$</li>
                <li><b>Parameter type</b> 
                    <ul>
                        <li>Direct ⇒ you want the user to enter a parameter without choosing it from a predefined list.  </li>
                        <li>Currency ⇒ For currency conversion, when you want the end user to specify a source or target currency.</li>
                        <li>Date ⇒ To retrieve data based on a date entered by the end user (or chosen in a calendar type input box).</li>
                        <li>Unit of Measure ⇒ To retrieve data based on a unit of measure chosen by the end user</li>
                        <li>Column ⇒ Value help from other views in the same view</li>
                        <li>Static List ⇒ Fixed values</li>
                        <li>Derived from table ⇒ from table outside of this view</li>
                        <li>Derived from procedure ⇒ When you want the parameter value to be passed to the calculation view based on the scalar output of a stored procedure  </li>
                    </ul>
                </li>
            </ul>
        </li>
        <li>Restricted Columns
            <ul>
                <li>A restricted column is a generated column that is made from a measure filtered by one or more attributes values  </li>
                <li>The value in a restricted column is 0 for all rows that do not match the defined filter condition(s).  </li>
                <li>The benefit of a restricted column is that it provides the modeler with a ready-made object that is useful when you are creating calculated columns as the base objects are already filtered. This simplifies the creation of calculated columns </li>
                <li>CASE 
    WHEN Sales &gt; 100 THEN Sales 
    ELSE NULL 
END
</li>
                <li>The filtering happens on every row. Only those rows that satisfy the condition (e.g., <i>Sales &gt; 100</i>) provide a valid number. All other rows effectively have “no value” (0 or NULL) in that column. This way, when you later create calculated columns based on this restricted column, you’re already working with filtered data.  </li>
                <li>From SAP HANA Cloud QRC 3/2023 onwards, it is possible to define the restriction based not only on attribute columns, but also on measure columns.  </li>
                <li>You have the option to hide the restricted column, for example to reuse it in a calculated column and thereby make it unavailable for reporting.</li>
                <li>If there are different lines in the restriction, all the lines defined on the same column are combined with the logical operator <i>OR</i>, and then, all the sets of restrictions for different columns are combined with the logical operator, <i>AND</i>.  </li>
                <li><img src="https://remnote-user-data.s3.amazonaws.com/MFcD4eS-U95KFRyQv4SnsrpLWxQ8_HE4VtYZtSrSv-vWfkqMavnROtwZKizP8jRLLUgUFpCXjqeu-mHktaKLBDXdde5GFPt3Ubw2vhEYNItntSArVVdboIaK9YhpThBM.png" width="479" height="306.59918200409"/>\</li>
                <li>Suppose if a table has data from different region let&#39;s say US, EU</li>
                <li>With the help of restricted column US employees can only see U.S. data and for other countries it is null</li>
                <li>Select any node in <b>Cube </b>⇒ Go to Restricted Column ⇒ You can select Base Measure ⇒ TOTAL_SALES</li>
                <li>Restrictions ⇒ pick Columns or Expression</li>
                <li>Check Include</li>
                <li>is used to specify whether the records that meet the defined restrictions should be included or excluded in the aggregation. For example, if you restrict the column to include only records where the year is 2021, only those records will be aggregated.</li>
                <li>SELECT SUM(Revenue) FROM Sales WHERE Year = 2021  </li>
                <li>Unchecked Include</li>
                <li>The restricted column will exclude the records where the Year is 2021 from the aggregation. This means the total revenue will be calculated for all years except 2021.</li>
                <li>SELECT SUM(Revenue) FROM Sales WHERE Year != 2021  </li>
                <li>For values that don&#39;t fit the filter condition of restricted column is shown as null</li>
                <li><img src="https://remnote-user-data.s3.amazonaws.com/C0cl10jOHwo0j2IXQ3EDAMINneLasZgDSeRs3IxPfOk55sNO-qz65ZxJHAp_bst7oXZ_Dbnf77m3KsSWE2HpnfiKW6-RBy47bOUdtHPMKaLo1BGtZDM8Gnn7oljZiOdY.png" width="479" height="174.359918200409"/></li>
            </ul>
        </li>
        <li>Calculated Columns
            <ul>
                <li>It is possible to create additional calculated columns in any type of calculation view node.</li>
                <li>Calculated columns are generated on the fly at runtime and do not persist the result.</li>
                <li>It is possible to nest calculated columns, so that one calculated column is based on other calculated columns.</li>
                <li>A calculated column can use the string functions, mathematical functions etc. available in the editor.</li>
                <li><img src="https://remnote-user-data.s3.amazonaws.com/UWHVKjFlJs40WLXlJFPDCKlYb87kdwNXsSfuMuQtZ1gxSD8eRRJskfg5Of-kLqmjyXfbRui1X-_3FFdXKmJP51r7SmGq7ODxdOchWenFEIM8CzTqkKcdG09_JqJhpWAr.png" width="479" height="272.3149284253579"/></li>
                <li>You can define a calculated column as measure or attribute.</li>
                <li>For certain measures, it is not possible to perform the calculations when the measures are already aggregated</li>
                <li><b>Enable Client Side Aggregation</b> 
                    <ul>
                        <li>Is a technique used to perform data aggregation on the client side rather than on the server side. This can be useful in scenarios where you want to offload some of the processing load from the server to the client,  </li>
                        <li>Consider an example where you have created the calculated measure MAXIMUM_GROSS_AMOUNT, giving you the maximum value of the gross amount. By selecting the Enable client side aggregation checkbox, you propose to the reporting client to also apply a maximum aggregation on the client side as defined in the Aggregation Type dropdown list.</li>
                        <li><img src="https://remnote-user-data.s3.amazonaws.com/C6ECY5Y3TNW5MnnQ09v6lbpQ8KqipHYJfGBlb2mUV4UuMv_aj0f_CD8_nrnrQjt813hlsyq9DAAdO_HpSvCrG6pHGIGh-Kyeg39WoMZzbiGFkyzOIVCBhVtOgzYhEJvq.png" width="459" height="272.0724946695096"/></li>
                    </ul>
                </li>
                <li><a isInlineLink="true" href="https://learning.sap.com/learning-journeys/develop-data-models-with-sap-hana-cloud/generating-calculated-columns_ade323bc-6ab2-4667-aded-3db6c32f6586">Consider Granularity When Creating Calculated Columns</a>
                    <ul>
                        <li>For certain measures, it is not possible to perform the calculations when the measures are already aggregated. The aggregated granularity of, for example, Price does not mean anything.</li>
                        <li><img src="https://remnote-user-data.s3.amazonaws.com/ge3JDfYdSO48pSfhkJ16Q2PcYvkLPlIdC0QjE2XE01B78KJ0fmVSGNPRiOEOr7hvvujOp-0aKTLZzE52soh2bxV3_1cPUM1dtlhQSD4u7p-K6vB4yTYPO46tfdIFeu-q.png" width="927" height="504.55709711846316"/></li>
                        <li>In the figure, in the sum line highlighted in red, the units as well as the price have been aggregated. Multiplying these to aggregates does not give a meaningful result.</li>
                    </ul>
                </li>
            </ul>
        </li>
        <li>Parameter Mapping
            <ul>
                <li>In some cases, your calculation view needs to pass information provided by the user, via a variable or input parameter, to another object. This could be another calculation view or even a procedure or function.</li>
                <li>To enable parameter mapping, you must use the <i>Input Parameter/Variables Mapping</i> feature. You can find this feature in the <i>Parameters</i> tab in the calculation view.  </li>
                <li><img src="https://remnote-user-data.s3.amazonaws.com/hV5Kb9cyt8IYwFORp5ceMpK2dXwbBkSX8h2hl1Ot90hXXgM_Oa4dMDjLiZjGG-BpBPejGxRa1zubtSQDgBXECQbNkyOsQ9PuDNvLAiRDoM77TqQhWtqAq9vR9tx2g6zF.png" width="479" height="189.05316973415134"/></li>
                <li>You can only map Variables to Variables and Input Parameters to Input Parameters. Cross-Mapping (such as an Input Parameter to a Variable) is not possible.</li>
                <li>From SAP HANA Cloud QRC 1/2024 onwards, it is possible to define an input parameter and at the same time propagate this parameter to other views within the same HDB module that consume this calculation view. Similarly, it is possible to delete an input parameter and propagate the deletion to the consuming calculation views.</li>
                <li>From SAP HANA Cloud QRC 1/2022 onwards, it is possible to pass input parameters from a Calculation View to an SQL View or a Calculation View that is accessed remotely as a Virtual Table. This ensures that filters are pushed down and executed as close to the data sources as possible.  </li>
                <li>This new feature requires Smart Data Access (SDA), relying on the odbc adapter – it is not possible with remote sources accessed through the Smart Data Integration (SDI) adapter. The scenario supports remote SAP HANA databases running on SAP HANA Cloud, or SAP HANA On-Premise version 2.0 minimum.  </li>
                <li>Besides, in SAP HANA On-Premise, Input Parameters in SQL Views are supported only from version 2.0 SPS02 onwards.</li>
                <li>Select Type
                    <ul>
                        <li><b>Data Sources</b> </li>
                        <li>Map input parameters of the underlying data source like calculation views to input parameters of the current calculation view</li>
                        <li><b>Procedures/Scalar Functions for input parameters</b> </li>
                        <li>if you want to map the input parameters defined in the procedure or scalar function to the input parameters of the current calculation view</li>
                        <li><b>Views for value help for variables/input parameters</b> </li>
                        <li>If you want to map input parameters or variables defined in the external views which are used as value help to the input parameters or variables of the current calculation view.</li>
                        <li><b>Views for value help for attributes</b> </li>
                        <li>If you have defined a value help view or a table that provides values to filter the attribute at runtime to the input parameters or variables of the current calculation view.</li>
                    </ul>
                </li>
            </ul>
        </li>
        <li>Generate Properties File for Calculation Views
            <ul>
                <li>file that contains the name and description of all calculation views objects such as columns, input parameters and variables.</li>
                <li>To generate the properties file, select a calculation view and choose the menu option Modelling ⇒ Generate Properties File.</li>
                <li>You first generate the properties file for the calculation view and then you must build the SAP HANA Database Module that contains this generated file so that the names and description values are then stored in the BIMC_DESCRIPTION table.</li>
                <li>One of the key reason for doing this is to enable translation of the name and description values to multiple languages by updating the BIMC_DESCRIPTION table.</li>
                <li>Client tools can read the BIMC_DESCRIPTION table and display values in the reporting tools respectively.</li>
            </ul>
        </li>
        <li>Filter
            <ul>
                <li>In Calculation Views, filters can be applied to many node types. These include the following: Projection, Union, Join, Rank, Aggregation, Star Join</li>
                <li>When a column from a data source (for example COUNTRY), is mapped to the node output with a different name (for example, COUNTRY_CODE), the output column name must be used in the expression. In this case, the correct expression would be something like &quot;COUNTRY_CODE&quot;=&#39;US&#39;. If you enter the expression &quot;COUNTRY&quot;=&#39;US&#39;, the expression might validate but building the calculation view will fail.</li>
                <li><b>Filters defined in the top node</b> </li>
                <li>In an Aggregation or Star Join node, the filter is applied to the data before the aggregation is executed.</li>
                <li><b>Filters defined in other nodes</b> </li>
                <li>In other nodes (NON top nodes), the filter expression is generally applied to the output of the node.</li>
                <li>Pushing Down Filters
                    <ul>
                        <li>Filter Pushdown is a technique used in databases to make data retrieval faster and more efficient. Pushdown in this context means that a filter that is defined on a node or in a query becomes effective in lower nodes. This reduces the amount of data the database has to process, saving time and resources.</li>
                        <li>Filters are generally pushed down during query execution if this does not change the semantics of the query (The <b>result</b> of the query must stay <b>exactly the same</b> even after applying filter pushdown)</li>
                        <li>Filter pushdown does not occur per default for <a isRemReference="true" href="../SAP%20HANA/Nodes/Rank%20Node.html?isPin=false">Rank Node</a>, <a isRemReference="true" href="../SAP%20HANA/Nodes/Window%20function%20nodes.html?isPin=false">Window function nodes</a>, and nodes that feed into two other nodes  </li>
                        <li>However, you can force a pushdown even in these situations by using one of the following options:  </li>
                        <li><b>Allow Filter Push Down</b> – for <a isRemReference="true" href="../SAP%20HANA/Nodes/Rank%20Node.html?isPin=false">Rank Node</a> and <a isRemReference="true" href="../SAP%20HANA/Nodes/Window%20function%20nodes.html?isPin=false">Window function nodes</a></li>
                        <li><b>Ignore Multiple Outputs for Filter</b> – when a node is consumed by two nodes</li>
                        <li><img src="https://remnote-user-data.s3.amazonaws.com/fToe_xE_A6jxHt5EuF57LiQ_AXbVC8slUslTV3XOIDoECLE8Zr5W4BUlcDl4UbuqJ5TVwZUZItssSRW3gBAw6ciywfL9yJSZVLoulASjNGZesqVn09_0XsTpFBCSIU4j.png" width="455" height="307.247311827957"/></li>
                        <li>In your calculation view, if you have defined a node that is a source to more than one other node (in other words the data flow splits), then you need to be aware that this can potentially block filter push-down. The SQL optimizer does not want to break the semantics of the query and so by default it keeps the filter at the node at which it is defined (and this node might be high up in the stack causing large data sets to travel up the stack).  </li>
                        <li>If push-down does not violate semantic correctness, flag <b>Ignore Multiple Outputs for Filter </b>can be set to enforce filter push-down.</li>
                        <li>In SAP HANA Cloud, you often use <b>calculation views</b> to combine and analyse data from multiple tables. Suppose you have a calculation view that unions two tables—say, sales data from two different regions—and you only want rows where the status is &quot;active.&quot;</li>
                        <li><a isInlineLink="true" href="https://help.sap.com/docs/hana-cloud-database/sap-hana-cloud-sap-hana-database-performance-guide-for-developers/example-ignore-multiple-outputs">Example of Enforced Pushdown</a> </li>
                        <li>A similar setting can be applied at the view level in the semantic node View Properties &gt; Advanced. It has the same effect but applies to scenarios where one calculation view is consumed multiple times by another calculation view.</li>
                    </ul>
                </li>
                <li>Verify that the filters are pushed down to the base tables</li>
                <li>Avoid including calculated columns in filter expressions</li>
            </ul>
        </li>
        <li>Sequence
            <ul>
                <li>It is a database object that automatically generates the incremental list of numbers according to the rules as specified in the sequence specification</li>
                <li>In SAP HANA, a sequence is an object that maintains its own internal counter, When you call the function <b>NEXTVAL</b> on a sequence, it generates the next number based solely on its internal state, not by looking at the table’s current values.  </li>
                <li>CREATE TABLE my_table (
    id INT DEFAULT seq_id.NEXTVAL,
    name VARCHAR(50)
);

INSERT INTO my_table(name) VALUES(&#39;John&#39;);</li>
                <li>Every time you insert a new row without explicitly providing a value for the <q>id</q> column, the <b>NEXTVAL</b> function is called. This increments the sequence’s internal counter and assigns the new number.  </li>
                <li>create sequence schema.nameofseq START WITH 1 INCREMENT BY 1 NO MAXVALUE;

INSERT INTO MY_TABLE (ID, DATA) VALUES (schema.nameofseq.NEXTVAL, &#39;Some data&#39;);

SELECT mySequence.CURRVAL FROM DUMMY; </li>
                <li><b>Sequence Parameter</b> </li>
                <li>START WITH &lt;start_value&gt;
 | INCREMENT BY &lt;increment_value&gt;
 | MAXVALUE &lt;max_value&gt;
 | NO MAXVALUE
 | MINVALUE &lt;min_value&gt;
 | NO MINVALUE
 | CYCLE
 | NO CYCLE
 | CACHE &lt;cache_size&gt;
 | NO CACHE  </li>
                <li><b>CACHE </b>- Refers to a mechanism that pre-allocates a set of sequence values and stores them in memory for faster access  </li>
                <li><b>NO CYCLE </b> - it means that the sequence will not restart from its initial or minimum value once it reaches its maximum value, Instead, it will stop generating new values and return an error if an attempt is made to generate a value beyond its defined range.</li>
            </ul>
        </li>

    </ul>
    </body>
</html>
